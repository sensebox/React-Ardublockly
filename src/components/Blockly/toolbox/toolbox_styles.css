/* =============================================================================
   EMBEDDED MODE TOOLBOX STYLES
   ============================================================================= */

/* -----------------------------------------------------------------------------
   CSS Variables & Base Configuration
   ----------------------------------------------------------------------------- */
.embedded-mode .blocklyToolbox {
  --cat-height: 42px;
  --cat-padding-x: 8px;
  --cat-col-gap: 8px;
  --cat-cols: 4;
  --cat-col-width: calc((100% - (var(--cat-cols) - 1) * var(--cat-col-gap)) / var(--cat-cols));
  
  /* Chevron constants */
  --chevron-size: 6px;
  --chevron-border: 2px;
  --chevron-transition: transform 120ms ease;
  --chevron-right-offset: calc(2 * var(--cat-padding-x));
}

/* -----------------------------------------------------------------------------
   Search Field Styling
   ----------------------------------------------------------------------------- */
.embedded-mode input[type="search"] {
  width: calc(100vw -  var(--cat-padding-x)) ;
  vertical-align: middle !important;
  user-select: text !important;
  -webkit-user-select: text !important;
}
/* Search should occupy the full first line (all 4 columns) */
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryContainer:has(input[type="search"]) {
  max-width: calc(100vw - 12px) !important;
}

/* -----------------------------------------------------------------------------
   Category Button Styling
   ----------------------------------------------------------------------------- */
.embedded-mode .blocklyToolbox .blocklyToolboxCategory {
  height: var(--cat-height) !important;
  border-radius: 5px;
  background: #fff;
  padding: 0 2px 0 0 !important; /* Remove Blockly's default indentation */
  position: relative;
  width: 100%;
}

/* Disable focus styling */
.embedded-mode .blocklyToolboxCategory:focus,
.embedded-mode .blocklyToolboxCategoryContainer:focus,
.embedded-mode .blocklyTreeRow:focus,
.embedded-mode .blocklyTreeLabel:focus {
  outline: none !important;
  box-shadow: none !important;
}

/* -----------------------------------------------------------------------------
   Category Layout & Positioning
   ----------------------------------------------------------------------------- */
/* Top-level categories: fixed-width grid (fit var(--cat-cols) per row) */
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryContainer[aria-level="1"] {
  display: flex !important;
  flex: 0 0 var(--cat-col-width) !important;
}

/* -----------------------------------------------------------------------------
   Expanded Category Layout (Subcategories)
   ----------------------------------------------------------------------------- */
/* When a category is expanded, its subcategories should flow horizontally */
.embedded-mode .blocklyToolboxCategoryContainer[aria-expanded="true"] {
  flex-wrap: wrap !important;
}
/* -----------------------------------------------------------------------------
   Chevron Icons for Expandable Categories
   ----------------------------------------------------------------------------- */
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryIconClosed,
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryIconOpen {
  position: absolute;
  right: var(--chevron-right-offset);
  color: var(--cat-accent, currentColor);
}

.embedded-mode .blocklyToolbox .blocklyToolboxCategoryIconClosed::before,
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryIconOpen::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  width: var(--chevron-size);
  height: var(--chevron-size);
  border-right: var(--chevron-border) solid currentColor;
  border-bottom: var(--chevron-border) solid currentColor;
  transform-origin: center;
  transition: var(--chevron-transition);
}

/* Rotate when the container is expanded */
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryContainer[aria-expanded="true"] .blocklyToolboxCategoryIconClosed::before {
  transform: translate(-50%, -50%) rotate(45deg);
}

/* Rotate when the container is closed */
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryContainer[aria-expanded="false"] .blocklyToolboxCategoryIconClosed::before {
  transform: translate(0%, -50%) rotate(-45deg);
}

/* -----------------------------------------------------------------------------
   Category Row Layout & Typography
   ----------------------------------------------------------------------------- */
.embedded-mode .blocklyToolbox .blocklyTreeRowContentContainer {
  display: flex;
  align-items: center;
  min-height: var(--cat-height) !important;
  padding-right: 24px; /* reserve space for absolute chevron */
}

/* -----------------------------------------------------------------------------
   Visual Distinction for Subcategory Levels
   ----------------------------------------------------------------------------- */
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryContainer[aria-level="2"] .blocklyToolboxCategory:not(:has(input[type="search"])) {
  background: #E8F5E8; /* light green */
}

.embedded-mode .blocklyToolbox .blocklyToolboxCategoryContainer[aria-level="3"] .blocklyToolboxCategory:not(:has(input[type="search"])) {
  background: #FFF3E0; /* light orange */
}

.embedded-mode .blocklyToolbox .blocklyToolboxCategoryContainer[aria-level="4"] .blocklyToolboxCategory:not(:has(input[type="search"])) {
  background: #F3E5F5; /* light purple */
}

/* -----------------------------------------------------------------------------
   Touch Optimizations (iPad)
   ----------------------------------------------------------------------------- */
.embedded-mode .blocklyToolboxCategory {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

.embedded-mode .blocklyFlyout .blocklyBlockCanvas > .blocklyDraggable {
  margin: 8px 0 !important;
}

.embedded-mode .blocklyScrollbarHandle {
  width: 12px !important;
  height: 12px !important;
}
