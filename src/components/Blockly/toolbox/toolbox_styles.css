/* =============================================================================
   EMBEDDED MODE TOOLBOX STYLES
   ============================================================================= */

/* -----------------------------------------------------------------------------
   CSS Variables & Base Configuration
   ----------------------------------------------------------------------------- */
.embedded-mode .blocklyToolbox {
  --cat-height: 42px;
  --cat-padding-x: 8px;
  --cat-min-width: calc(25vw - 9px);
  
  /* Chevron constants */
  --chevron-size: 6px;
  --chevron-border: 2px;
  --chevron-transition: transform 120ms ease;
  --chevron-right-offset: calc(2 * var(--cat-padding-x));
}

/* -----------------------------------------------------------------------------
   Search Field Styling
   ----------------------------------------------------------------------------- */
.embedded-mode input[type="search"] {
  width: calc(100vw);
  vertical-align: middle !important;
  user-select: text !important;
  -webkit-user-select: text !important;
}

/* -----------------------------------------------------------------------------
   Category Button Styling
   ----------------------------------------------------------------------------- */
.embedded-mode .blocklyToolbox .blocklyToolboxCategory {
  height: var(--cat-height) !important;
  border-radius: 5px;
  background: #fff;
  padding: 0 2px 0 0 !important; /* Remove Blockly's default indentation */
  position: relative;
  width: var(--cat-width);
  flex-shrink: 0;
}

/* Disable focus styling */
.embedded-mode .blocklyToolboxCategory:focus,
.embedded-mode .blocklyToolboxCategoryContainer:focus,
.embedded-mode .blocklyTreeRow:focus,
.embedded-mode .blocklyTreeLabel:focus {
  outline: none !important;
  box-shadow: none !important;
}

/* -----------------------------------------------------------------------------
   Category Layout & Positioning
   ----------------------------------------------------------------------------- */
/* Main toolbox container: natural flow */
.embedded-mode .blocklyToolbox {
  padding: var(--cat-padding-x);
}

/* Apply minimum width to all category containers */
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryContainer {
  min-width: var(--cat-min-width) !important;
}

/* -----------------------------------------------------------------------------
   Expanded Category Layout (Subcategories)
   ----------------------------------------------------------------------------- */
/* Force subcategories to flow horizontally */
.embedded-mode .blocklyToolboxCategoryContainer[aria-level="2"],
.embedded-mode .blocklyToolboxCategoryContainer[aria-level="3"],
.embedded-mode .blocklyToolboxCategoryContainer[aria-level="4"] {
  display: inline-block !important;
  vertical-align: top !important;
}

/* Override horizontal layout for search field */
.embedded-mode .blocklyToolboxCategoryContainer:has(input[type="search"]) {
  display: block !important;
  width: 100% !important;
}

/* Override horizontal layout margins for search field */
.embedded-mode .blocklyToolbox[layout="h"] .blocklyToolboxCategoryContainer:has(input[type="search"]) {
  margin: 0 0 0-3px;
}

/* Remove right padding from the last subcategory */
.embedded-mode .blocklyToolboxCategoryContainer[aria-level="2"]:last-child,
.embedded-mode .blocklyToolboxCategoryContainer[aria-level="3"]:last-child,
.embedded-mode .blocklyToolboxCategoryContainer[aria-level="4"]:last-child {
  padding-right: 0 !important;
  margin-right: 0 !important;
}

/* Remove left padding from every fourth subcategory */
.embedded-mode .blocklyToolboxCategoryContainer[aria-level="2"]:nth-child(4n),
.embedded-mode .blocklyToolboxCategoryContainer[aria-level="3"]:nth-child(4n),
.embedded-mode .blocklyToolboxCategoryContainer[aria-level="4"]:nth-child(4n) {
  margin-right: 0 !important;
  padding-right: 0 !important;
}

/* Ensure expanded categories maintain fixed width but allow subcategories to be visible */
.embedded-mode .blocklyToolboxCategoryContainer[aria-expanded="true"] {
  display: inline-block !important;
}
/* -----------------------------------------------------------------------------
   Chevron Icons for Expandable Categories
   ----------------------------------------------------------------------------- */
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryIconClosed,
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryIconOpen {
  position: absolute;
  right: var(--chevron-right-offset);
  color: var(--cat-accent, currentColor);
}

.embedded-mode .blocklyToolbox .blocklyToolboxCategoryIconClosed::before,
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryIconOpen::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  width: var(--chevron-size);
  height: var(--chevron-size);
  border-right: var(--chevron-border) solid currentColor;
  border-bottom: var(--chevron-border) solid currentColor;
  transform-origin: center;
  transition: var(--chevron-transition);
}

/* Rotate when the container is expanded */
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryContainer[aria-expanded="true"] .blocklyToolboxCategoryIconClosed::before {
  transform: translate(-50%, -50%) rotate(45deg);
}

/* Rotate when the container is closed */
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryContainer[aria-expanded="false"] .blocklyToolboxCategoryIconClosed::before {
  transform: translate(0%, -50%) rotate(-45deg);
}

/* -----------------------------------------------------------------------------
   Category Row Layout & Typography
   ----------------------------------------------------------------------------- */
.embedded-mode .blocklyToolbox .blocklyTreeRowContentContainer {
  display: flex;
  align-items: center;
  min-height: var(--cat-height) !important;
  padding-right: 24px; /* reserve space for absolute chevron */
}

/* -----------------------------------------------------------------------------
   Visual Distinction for Subcategory Levels
   ----------------------------------------------------------------------------- */
.embedded-mode .blocklyToolbox .blocklyToolboxCategoryContainer[aria-level="2"] .blocklyToolboxCategory:not(:has(input[type="search"])) {
  background: #E8F5E8; /* light green */
}

.embedded-mode .blocklyToolbox .blocklyToolboxCategoryContainer[aria-level="3"] .blocklyToolboxCategory:not(:has(input[type="search"])) {
  background: #FFF3E0; /* light orange */
}

.embedded-mode .blocklyToolbox .blocklyToolboxCategoryContainer[aria-level="4"] .blocklyToolboxCategory:not(:has(input[type="search"])) {
  background: #F3E5F5; /* light purple */
}

/* -----------------------------------------------------------------------------
   Touch Optimizations (iPad) - Using shared .touch-optimized class
   ----------------------------------------------------------------------------- */
.embedded-mode .blocklyToolboxCategory {
  /* Use shared touch optimizations from shared-styles.css */
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

.embedded-mode .blocklyFlyout .blocklyBlockCanvas > .blocklyDraggable {
  margin: 8px 0 !important;
}

.embedded-mode .blocklyScrollbarHandle {
  width: 12px !important;
  height: 12px !important;
}
